function add_bar() {
  let urlParams = new URLSearchParams(window.location.search);
  let navbar = document.querySelector('div.index-navbar');

  if (navbar && urlParams.has('project')) {
    navbar.setAttribute('class', 'index-navbar'); // removes hidden
    let project = decodeURIComponent(urlParams.get('project'));
    let index_root = project + '/.index/';
    let build = project + '/Build/';

    let links = [ { "Extensions": index_root + 'doc/Extensions.html' },
                  { "Debug Log": build + 'debug_log.html' },
                  { "Problems": build + 'problems.html' },
                  { "Source": index_root + 'story.html' },
                  { "Project Index": index_root + 'Index/Welcome.html' } ];
                  let sp = document.createTextNode(" ");
    links.forEach(h => {
      Object.entries(h).forEach(([text, url]) => {
        let my_id = text.toLowerCase().replace(' ', '_')
        let a = document.querySelector('#'+my_id)
        let url_target = "file://"+url+"?project="+encodeURIComponent(project);
        if (a) {
            a.href=url_target;
        }
        else {
          a = document.createElement('a');
          let href = document.createAttribute("href");
          href.value = url_target;
          a.setAttributeNode(href);
          let elem_id = document.createAttribute("id");
          elem_id.value = my_id;
          a.setAttributeNode(elem_id);
          let linktext = document.createTextNode(text);
          a.appendChild(linktext);
          navbar.insertBefore(sp.cloneNode(), navbar.firstChild);
          navbar.insertBefore(a, navbar.firstChild);
          }
        })});
  }
}

document.addEventListener("DOMContentLoaded", add_bar);